{% extends 'game/base.html' %}
{% load number_filters %}

{% block title %}ìœ ë‹ˆì½˜ ë©”ì´ì»¤ - ëŒ€ë°• ì•„ë‹ˆë©´ ìª½ë°•!{% endblock %}

{% block content %}
<div class="main-page">
    <!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
    <div id="loading-overlay" class="loading-overlay">
        <div class="loading-content">
            <div class="loading-spinner"></div>
            <p class="loading-text">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
        </div>
    </div>
    <!-- íˆì–´ë¡œ ì„¹ì…˜ -->
    <section class="hero">
        <h1>ğŸ¦„ ìœ ë‹ˆì½˜ ë©”ì´ì»¤</h1>
        <p class="slogan">ëŒ€ë°• ì•„ë‹ˆë©´ ìª½ë°•! ë‹¹ì‹ ì˜ ì„ íƒì€?</p>
        
        {% if user.is_authenticated %}
            {% if active_session %}
                <!-- ì§„í–‰ ì¤‘ì¸ ê²Œì„ ìˆìŒ -->
                <a href="{% url 'game:play' session_id=active_session.pk %}" class="btn btn-primary" onclick="showLoading()">
                    ğŸ® ê²Œì„ ê³„ì†í•˜ê¸°
                </a>
                <p class="session-info">
                    ë‚¨ì€ ìë³¸: {{ active_session.current_capital|korean_currency }} | 
                    ë‚¨ì€ ê¸°íšŒ: {{ active_session.remaining_chances }}íšŒ
                </p>
            {% else %}
                <!-- ìƒˆ ê²Œì„ ì‹œì‘ -->
                <a href="{% url 'game:game_start' %}" class="btn btn-primary" onclick="showLoading()">
                    ğŸš€ ê²Œì„ ì‹œì‘
                </a>
            {% endif %}
        {% else %}
            <!-- ë¹„ë¡œê·¸ì¸ -->
            <a href="{% url 'game:login' %}" class="btn btn-primary">ë¡œê·¸ì¸í•˜ê³  ì‹œì‘</a>
            <a href="{% url 'game:signup' %}" class="btn btn-secondary">íšŒì›ê°€ì…</a>
        {% endif %}
    </section>

    <!-- ì˜¤ëŠ˜ì˜ Top 3 -->
    <section class="top3-section">
        <h2>ğŸ† ì˜¤ëŠ˜ì˜ Top 3</h2>
        {% if top3 %}
            <div class="top3-list">
                {% for session in top3 %}
                <div class="top3-item rank-{{ forloop.counter }}">
                    <span class="rank">{{ forloop.counter }}</span>
                    <span class="nickname">{{ session.user.nickname }}</span>
                    <span class="profit">{{ session.final_profit_rate|floatformat:1 }}%</span>
                </div>
                {% endfor %}
            </div>
        {% else %}
            <p>ì•„ì§ ì˜¤ëŠ˜ì˜ ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤. ì²« ë²ˆì§¸ íˆ¬ìë¥¼ ì‹œì‘í•˜ì„¸ìš”!</p>
        {% endif %}
        <a href="{% url 'game:ranking' %}" class="btn btn-link">ì „ì²´ ë­í‚¹ ë³´ê¸° â†’</a>
    </section>

    <!-- ê²Œì„ ì„¤ëª… -->
    <section class="how-to-play">
        <h2>ğŸ¯ ê²Œì„ ë°©ë²•</h2>
        <ol>
            <li>ìë³¸ê¸ˆ 1ì–µìœ¼ë¡œ ì‹œì‘</li>
            <li>5ì¸ì˜ ì°½ì—…ê°€ê°€ ì œì•ˆí•˜ëŠ” ì•„ì´ë””ì–´ì— íˆ¬ì</li>
            <li>5ì¸ì˜ ì°½ì—…ê°€ë§ˆë‹¤ ë‹¤ë¥¸ ë“±ì¥í™•ë¥ /ì„±ê³µë¥ /ìˆ˜ìµë¥ </li>
            <li>ì„±ê³µí•˜ë©´ ìµœëŒ€ 2000% ìˆ˜ìµ! ì‹¤íŒ¨í•˜ë©´ ì „ì•¡ ì†ì‹¤...!</li>
            <li>5ë²ˆì˜ ê¸°íšŒë¡œ ìµœê³  ìˆ˜ìµë¥  ë‹¬ì„±!</li>
        </ol>
    </section>
    <script>
    function showLoading() {
        const messages = [
            "ğŸƒ ì°½ì—…ê°€ê°€ ë¯¸íŒ…ë£¸ìœ¼ë¡œ ë›°ì–´ì˜¤ëŠ” ì¤‘...",
            "ğŸ’¼ ì°½ì—…ê°€ê°€ ì•„ì´ë””ì–´ ë°œí‘œì¤€ë¹„ ì¤‘...",
        ];
        const randomMsg = messages[Math.floor(Math.random() * messages.length)];
        document.querySelector('.loading-text').textContent = randomMsg;
        document.getElementById('loading-overlay').style.display = 'flex';
    }
    </script>
</div>
{% endblock %}
