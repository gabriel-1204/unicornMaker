{% extends 'game/base.html' %}
{% load static %}
{% load number_filters %}

{% block title %}íˆ¬ìí•˜ê¸° - ìœ ë‹ˆì½˜ ë©”ì´ì»¤{% endblock %}

{% block content %}
<!-- ë¡œë”© ì˜¤ë²„ë ˆì´ -->
<div id="loading-overlay" class="loading-overlay">
    <div class="loading-content">
        <div class="loading-spinner"></div>
        <p class="loading-text">ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...</p>
    </div>
</div>

<div class="play-page">

    <!-- ìºë¦­í„° & ì•„ì´ë””ì–´ -->
    <div class="character-box">
        <div class="character-info">
            <div class="character-image">
                <img src="{% static 'images/characters/' %}{{ character.key }}.png" alt="{{ character.name }}">
            </div>
            <h2>{{ character.name }}</h2>
            <p class="character-concept">{{ character.concept }}</p>
        </div>
        
        <div class="idea-bubble">
            <h3>ğŸ’¡ {{ idea.title }}</h3>
            <p>{{ idea.description }}</p>
        </div>
    </div>

    <!-- íˆ¬ì í¼ -->
    <div class="invest-section">
        <!-- ê²Œì„ ìƒíƒœ í‘œì‹œ -->
        <div class="game-status">
            <div class="status-item">
                <span class="label">ğŸ’°ìë³¸ê¸ˆ</span>
                <span class="value">{{ session.current_capital|korean_currency }}</span>
            </div>
            <div class="status-item">
                <span class="label">ğŸ¯ë‚¨ì€ ê¸°íšŒ</span>
                <span class="value">{{ session.remaining_chances }}íšŒ</span>
            </div>
        </div>
        <form method="POST" action="{% url 'game:invest' session_id=session.pk %}" onsubmit="showLoading()">
            {% csrf_token %}
            
            <div class="form-group">
                <label>íˆ¬ì ê¸ˆì•¡ (ë§Œì›)</label>
                <input type="number" name="amount" 
                       max="{{ session.current_capital }}" 
                       id = "amount"
                       value = 2000
                       required>
                       <!-- min, value 2000 ë¹¼ê³  ìµœì†Ÿê°’ ë³„ë„ ì§€ì • -->

                <!-- <small>ìµœì†Œ 2,000ë§Œì› ì´ìƒ íˆ¬ì ê°€ëŠ¥</small> -->
                <small>2000ë§Œì› ì´ìƒ í˜¹ì€ ì˜¬ì¸ë§Œ ê°€ëŠ¥</small>
            </div>            
            <div class="btn-group">
                <button type="submit" class="btn btn-primary">ğŸ’¸íˆ¬ìí•˜ê¸°</button>
                <button type="button" class="btn btn-danger" onclick="setAllIn()">ğŸ”¥ì˜¬ì¸</button>
                <a href="{% url 'game:pass' session_id=session.pk %}" class="btn btn-secondary" onclick="showLoading2()">â­ï¸íŒ¨ìŠ¤</a>
            </div>
        </form>
        
        <script>
        // ì˜¬ì¸ ê¸°ëŠ¥
        function setAllIn() {
            const maxCapital = {{ session.current_capital }};
            document.querySelector('input[name="amount"]').value = maxCapital;
        }
        
        // ìµœì†Ÿê°’ ì„¤ì •
        const minVal = Math.min(2000, {{ session.current_capital }})
        document.getElementById('amount').value = minVal
        document.getElementById('amount').min = minVal
        
        // ë¡œë”© ì˜¤ë²„ë ˆì´ í‘œì‹œ
        function showLoading() {
            const messages = [
                "ğŸƒ íˆ¬ìí•œ íšŒì‚¬ê°€ ì—´ì‹¬íˆ êµ´ëŸ¬ê°€ëŠ” ì¤‘...",
                "ğŸ’¼ ì°½ì—…ê°€ê°€ ì‚¬ì—… ì¤€ë¹„ ì¤‘...",
                "ğŸš€ ìŠ¤íƒ€íŠ¸ì—…ì´ ì„±ì¥í•˜ëŠ” ì¤‘...",
                "ğŸ”¨ íˆ¬ìê¸ˆìœ¼ë¡œ ì—´ì‹¬íˆ ì¼í•˜ëŠ” ì¤‘...",
                "ğŸ“ˆ ì‚¬ì—… ê²°ê³¼ë¥¼ ê¸°ë‹¤ë¦¬ëŠ” ì¤‘..."
            ];
            
            // ëœë¤ ì„ íƒ
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            document.querySelector('.loading-text').textContent = randomMsg;
            document.getElementById('loading-overlay').style.display = 'flex';
        }

        function showLoading2() {
            const messages = [
            "ğŸƒ ë‹¤ìŒ ì°½ì—…ê°€ê°€ ë¯¸íŒ…ë£¸ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ì¤‘...",
            "ğŸ’¼ ë‹¤ìŒ ì°½ì—…ê°€ê°€ ì•„ì´ë””ì–´ ë°œí‘œì¤€ë¹„ ì¤‘...",
            ];
            
            // ëœë¤ ì„ íƒ
            const randomMsg = messages[Math.floor(Math.random() * messages.length)];
            document.querySelector('.loading-text').textContent = randomMsg;
            document.getElementById('loading-overlay').style.display = 'flex';
        }
        </script>
    </div>
</div>
{% endblock %}